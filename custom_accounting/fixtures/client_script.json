[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2025-10-27 18:23:25.367756",
  "module": "Custom Accounting",
  "name": "Sales invoice script",
  "script": "frappe.ui.form.on('Sales Invoice', {\r\n    onload: function(frm) {\r\n\r\n        frm.set_df_property('items', 'cannot_add_multiple', true);\r\n        frm.set_df_property('items', 'allow_bulk_edit', false);\r\n        \r\n        if (frm.is_new()) {\r\n            setTimeout(() => {\r\n                show_only_add_row(frm);\r\n            }, 1000);\r\n        }\r\n    },\r\n    \r\n    refresh: function(frm) {\r\n\r\n        frm.set_df_property('items', 'cannot_add_multiple', true);\r\n        frm.set_df_property('items', 'allow_bulk_edit', false);\r\n        \r\n        update_buttons(frm);\r\n        \r\n        \r\n        setTimeout(() => {\r\n            $('.grid-add-multiple-rows').hide();\r\n            $('.btn-add-multiple-rows').hide();\r\n        }, 500);\r\n        \r\n        if (!window.buttonCheck) {\r\n            window.buttonCheck = setInterval(() => {\r\n                // Continuous hiding\r\n                frm.set_df_property('items', 'cannot_add_multiple', true);\r\n                frm.set_df_property('items', 'allow_bulk_edit', false);\r\n                $('.grid-add-multiple-rows').hide();\r\n                $('.btn-add-multiple-rows').hide();\r\n                update_buttons(frm);\r\n            }, 800);\r\n        }\r\n    },\r\n    \r\n    before_unload: function(frm) {\r\n        if (window.buttonCheck) {\r\n            clearInterval(window.buttonCheck);\r\n            window.buttonCheck = null;\r\n        }\r\n    }\r\n});\r\n\r\nfrappe.ui.form.on('Sales Invoice Item', {\r\n    item_code: function(frm, cdt, cdn) {\r\n        const row = locals[cdt][cdn];\r\n        if(row.item_code) {\r\n            frm.set_value('custom_item', row.item_code);\r\n        }\r\n        setTimeout(() => {\r\n            frm.set_df_property('items', 'cannot_add_multiple', true);\r\n            $('.grid-add-multiple-rows').hide();\r\n            update_buttons(frm);\r\n        }, 300);\r\n    },\r\n    \r\n    qty: function(frm, cdt, cdn) {\r\n        setTimeout(() => {\r\n            frm.set_df_property('items', 'cannot_add_multiple', true);\r\n            $('.grid-add-multiple-rows').hide();\r\n            update_buttons(frm);\r\n        }, 300);\r\n    },\r\n    \r\n    after_item_remove: function(frm, cdt, cdn) {\r\n        setTimeout(() => {\r\n            frm.set_df_property('items', 'cannot_add_multiple', true);\r\n            $('.grid-add-multiple-rows').hide();\r\n            update_buttons(frm);\r\n        }, 500);\r\n    },\r\n   \r\n    after_item_add: function(frm, cdt, cdn) {\r\n        setTimeout(() => {\r\n            frm.set_df_property('items', 'cannot_add_multiple', true);\r\n            $('.grid-add-multiple-rows').hide();\r\n            update_buttons(frm);\r\n        }, 500);\r\n    }\r\n});\r\n\r\nfunction update_buttons(frm) {\r\n    if (!frm.fields_dict.items) return;\r\n    \r\n    const has_items = frm.doc.items && frm.doc.items.length > 0;\r\n    \r\n    \r\n    frm.set_df_property('items', 'cannot_add_multiple', true);\r\n    frm.set_df_property('items', 'allow_bulk_edit', false);\r\n    \r\n    if (has_items) {\r\n    \r\n        frm.set_df_property('items', 'cannot_add_rows', true);\r\n        frm.set_df_property('items', 'cannot_delete_rows', false);\r\n    } else {\r\n    \r\n        frm.set_df_property('items', 'cannot_add_rows', false);\r\n        frm.set_df_property('items', 'cannot_delete_rows', true);\r\n    }\r\n    \r\n    $('.grid-add-multiple-rows').hide();\r\n    $('.btn-add-multiple-rows').hide();\r\n}\r\n\r\nfunction show_only_add_row(frm) {\r\n    \r\n    frm.set_df_property('items', 'cannot_add_rows', false);      \r\n    frm.set_df_property('items', 'cannot_add_multiple', true);   \r\n    frm.set_df_property('items', 'allow_bulk_edit', false);      \r\n    frm.set_df_property('items', 'cannot_delete_rows', true);    \r\n    frm.set_df_property('items', 'cannot_delete_all_rows', true); \r\n    \r\n    $('.grid-add-multiple-rows').hide();\r\n    $('.btn-add-multiple-rows').hide();\r\n}",
  "view": "Form"
 }
]